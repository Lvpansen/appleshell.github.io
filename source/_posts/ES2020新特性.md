---
title: ES2020æ–°ç‰¹æ€§
date: 2020-07-18 09:38:21
tags: Javascript
---

ES2020

<!-- more -->

## BigInt

Why:

ç›®å‰ JS ä¸­æœ€å¤§çš„æ•°æ˜¯`Math.pow(2,53) - 1`ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`Number.Number.MAX_SAFE_INTEGER`è·å¾—ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæ•°æ˜¯ js ä¸­å¯ä»¥å®‰å…¨é€’å¢çš„æœ€å¤§æ•´æ•°ï¼Œè¶…å‡ºè¿™ä¸ªæ•°å­—ä¹‹å¤–çš„è®¡ç®—å¯èƒ½å­˜åœ¨ç²¾åº¦ä¸¢å¤±çš„é—®é¢˜ã€‚

```js
Number.Number.MAX_SAFE_INTEGER + 1 === Number.Number.MAX_SAFE_INTEGER + 2; // true
```

whatï¼š

BigInt æ˜¯ js ä¸­çš„ä¸€ä¸ªæ–°çš„åŸå§‹æ•°æ®ç±»å‹ï¼Œåœ¨è¶…å‡ºåŸæ¥æœ€å¤§æ•°å­—é™åˆ¶çš„èŒƒå›´å¤–ï¼Œä¹Ÿå¯ä»¥å®‰å…¨çš„è¿›è¡Œå­˜å‚¨å’Œå¤§æ•°è¿ç®—ã€‚

how:

åˆ›å»º BigInt ç±»å‹æ•°æ®ï¼š

```js
let num = 474384383483n;

let num1 = BigInt(235423424);
let num2 = BigInt("235423424");

typeof num; // "bigint"
typeof num1; // "bigint"

9007199254740991n + 1n === 9007199254740991n + 2n; // false

// åœ¨æœ€å¤§å®‰å…¨æ•°èŒƒå›´å†…ï¼Œéä¸¥æ ¼æ¯”è¾ƒ
10n == 10; // true

// bigintå’Œnumberä½¿ç”¨æ–¹å¼ä¸€æ ·ï¼Œä½†æ˜¯ä¸¤è€…ä¸èƒ½æ··ç”¨ã€‚
10n / 10n; // 2n
20n / 2; // æŠ¥é”™ï¼šCannot mix bigInt adn other types

// åœ¨æœ€å¤§å®‰å…¨æ•°èŒƒå›´å†…ï¼Œbigintå¯ä»¥é€šè¿‡Number()è½¬æˆnumberç±»å‹ã€‚è¶…å‡ºèŒƒå›´çš„ä¸¢å¤±ä¼šå­˜åœ¨ç²¾åº¦ä¸¢å¤±
Number(100n); // 100

Number(900719925474099267n); // 900719925474099300
```

## Dynamic import

why:

åœ¨ä¹‹å‰çš„ js ä¸­ï¼Œå½“ import ä¸€ä¸ª module æ—¶ï¼Œæ— è®ºè¿™ä¸ª module ä¸­çš„æ–¹æ³•æˆ–å˜é‡æœ‰æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œè¿™ä¸ª module éƒ½ä¼šè¢«å¼•å…¥ã€‚

```js
import React, { Component } from "react";
import { print } from "./moduleA";

class App extends Component {
  handleClick = () => {
    print("moduleA will always be imported");
  };

  render() {
    return <button onClck={this.handleClick}>click</button>;
  }
}
```

whatï¼š

åŠ¨æ€åŠ è½½ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºæŒ‰éœ€åŠ è½½ï¼Œå¯ä»¥ç†è§£æˆæ˜¯åŸç”Ÿçš„ code-splittingã€‚

how:

import(module)æ–¹æ³•å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªè§£æä¸ºæ¨¡å—å¯¹è±¡çš„ promise

```js
import React, { Component } from "react";

class App extends Component {
  handleClick = () => {
    import("./moduleA")
      .then((module) => {
        module.print("moduleA will be imported when you click the button");
      })
      .catch((err) => {
        //
      });
  };

  render() {
    return <button onClick={this.handleClick}>click</button>;
  }
}
```

ä¹Ÿå¯ä»¥åœ¨ if-else ç­‰æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨ã€‚

éœ€è¦åŠ¨æ€importæ—¶å†ç”¨ã€‚ä¼˜å…ˆè¿˜æ˜¯ä½¿ç”¨é™æ€ï¼Œæœ‰åˆ©äºtree-shakingã€‚

Use dynamic import only when necessary. The static form is preferable for loading initial dependencies, and can benefit more readily from static analysis tools and tree shaking.

[ä½¿ç”¨åŠ¨æ€importçš„æƒ…æ™¯](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import)

[test link](https://codesandbox.io/s/twilight-bush-0bnt0?file=/src/App.js)

## Promise.allSettled

why:

`Promise.all()`æ–¹æ³•è¿”å›çš„ promise çš„çŠ¶æ€ç”±ä¼ å…¥çš„æ¯ä¸ª promise çš„çŠ¶æ€å†³å®šï¼Œåªè¦æœ‰ä¸€ä¸ªçŠ¶æ€æ˜¯ rejectedï¼Œåˆ™è¿”å›çš„ promise çš„çŠ¶æ€å°±æ˜¯ rejectedã€‚

```js
const promiseArray = [
  Promise.resolve("ğŸ•"),
  Promise.reject("ğŸ"),
  Promise.resolve("ğŸº"),
  Promise.reject(new Error("Oh No!")),
]
Promise.all(promiseArray)
  .then(data => {
    console.log('all resolved! the values are:' data)
  })
  .catch(err => {
    console.log('be rejectd! error is ', err)
  })

// be rejectd! error is null
```

what:

`Promise.allSettled()`æ¥å—ä¸€ä¸ª promise çš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œè¿”å›çš„ promise çŠ¶æ€æŒ‡æŒ¥å˜æˆ`fulfilled`ï¼Œæ— è®ºä¼ å…¥çš„æ¯ä¸ª promise çš„æ˜¯ resolved è¿˜æ˜¯ rejectedã€‚

how:

```js
const promiseArray = [
  Promise.resolve("ğŸ•"),
  Promise.reject("ğŸ"),
  Promise.resolve("ğŸº"),
  Promise.reject(new Error("Oh No!")),
];
Promise.allSettled(promiseArray)
  .then((data) => {
    console.log(data);
  })
  .catch((err) => {
    console.log("be rejectd! error is ", err);
  });

// [
//   {status: "fulfilled", value: "ğŸ•"},
//   {status: "rejected", reason: "ğŸ"},
//   {status: "fulfilled", value: "ğŸº"},
//   {status: "rejected", reason: Error: Oh No!}
// ]
```

## Nullish Coalescing

why:

é€šå¸¸æƒ…å†µä¸‹åœ¨è·å–å€¼çš„æ—¶å€™æˆ‘ä»¬ä¼šè®¾ç½®é»˜è®¤å€¼ï¼Œé˜²æ­¢é»˜è®¤å€¼æ˜¯ null æˆ–è€… undefinedã€‚ä¸€èˆ¬ä½¿ç”¨`||`æ¥å®ç°ï¼Œä½†åœ¨ ES2020 ä¹‹å‰ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œå¯ä»¥è½¬åŒ–ä¸º`false`çš„æ‰€æœ‰å€¼ï¼Œéƒ½ä¼šè·å–é»˜è®¤å€¼ã€‚

```js
const values = {
  nullValue: null,
  numberValue: 0,
  stringValue: "",
  booleanValue: false,
};

const value1 = values.dog || "cat"; // cat
const value2 = values.nullValue || "defalut value"; // defalut value
const value3 = values.numberValue || 300; // 300
const value4 = values.stringValue || "Hello"; // Hello
const value5 = values.booleanValue || true; // true
```

what:

`??`åˆ™åªä¼šåœ¨ç›®æ ‡å€¼ä¸º`null`å’Œ`undefined`æ—¶ï¼Œå–é»˜è®¤å€¼ã€‚ä½¿ç”¨ babel è½¬åŒ– ES5ï¼š

```js
const value = values.targetValue ?? "Hello";

// è½¬æ¢åæ˜¯ï¼š
var _values$targetValue;
const value =
  (_values$targetValue = values.targetValue) != null
    ? _values$targetValue
    : "Hello";

// or

const value =
  (_values$targetValue = values.targetValue) !== null &&
  _values$targetValue !== void 0
    ? _values$targetValue
    : "Hello";
```

how:

```js
const values = {
  nullValue: null,
  numberValue: 0,
  stringValue: "",
  booleanValue: false,
};

const value1 = values.dog ?? "cat"; // cat
const value2 = values.nullValue ?? "defalut value"; // defalut value
const value3 = values.numberValue ?? 0; // 0
const value4 = values.stringValue ?? "Hello"; // ""
const value5 = values.booleanValue ?? true; // false
```

## Optional Chaining

why:

```js
const stu = {
  name: "jack",
  edu: {
    school: "SS School",
    object: ["math", "science"],
    teacher: {
      math: ["Tom", "Lucy"],
    },
  },
};

let ScienceTeacher = stu.edu.classRoom.name; // Uncaught TypeError: Cannot read property 'name' of undefined

// å¢åŠ åˆ¤æ–­
let ScienceTeacher =
  stu && stu.edu && stu.edu.classRoom && stu.edu.classRoom.name;
```

what:

`?.`(å¯é€‰é“¾)å¯ä»¥å¤§å¹…ç®€åŒ–è¿™ç§å†™æ³•ã€‚ä½¿ç”¨ babel è½¬æ¢ï¼š

```js
let obj = {};

let target1 = obj?.person;

// è½¬æ¢åï¼š
let target1 = obj === null || obj === undefined ? void 0 : obj.person;
```

```js
let obj = {};

let target1 = obj?.person?.name;

// è½¬æ¢åï¼š
var _obj$person;

let target1 =
  obj === null || obj === undefined
    ? void 0
    : (_obj$person = obj.person) === null || _obj$person === undefined
    ? void 0
    : _obj$person.name;
```

how:

```js
const stu = {
  name: "jack",
  edu: {
    school: "SS School",
    object: ["math", "science"],
    teacher: {
      math: ["Tom", "Lucy"],
    },
  },
};

let ScienceTeacher = stu?.edu?.classRoom?.name ?? "room1";
```

`?.`æ“ä½œç¬¦æ˜¯çŸ­è·¯çš„ï¼Œå³å¦‚æœå®ƒçš„å·¦è¾¹çš„å€¼ä¸º`null`æˆ–`undefined`æ—¶ï¼Œå³è¾¹çš„ä»£ç ä¸ä¼šç»§ç»­æ‰§è¡Œã€‚

```js
let x = 0;
const a = ["bat", "foo"];

a?.[++x]; //a ä¸æ˜¯nullæˆ–undefinedæ—¶ï¼Œxæ‰ä¼šè®¡ç®—, è¿™é‡Œè¿”å›foo
```

å‡½æ•°è°ƒç”¨ä¹Ÿå¯ä»¥ä½¿ç”¨`?.`

```js
const func = (val) => console.log(val);

func?.("foo");
```

## String.matchAll

why:

```js
const regexp = /t(e)(st(\d?))/g;
const str = "test1test2";

str.match(regexp); // ["test1", "test2"]

while ((match = regexp.exec(str)) !== null) {
  console.log(match);
}
// ["test1", "e", "st1", "1", index: 0, input: "test1test2", groups: undefined]
// ["test2", "e", "st2", "2", index: 5, input: "test1test2", groups: undefined]

let iter = str.matchAll(regexp);
console.log([...iter]);
// ["test1", "e", "st1", "1", index: 0, input: "test1test2", groups: undefined]
// ["test2", "e", "st2", "2", index: 5, input: "test1test2", groups: undefined]
```

what:

`String.matchAll()`æ–¹æ³•è¿”å›ä¸€ä¸ª iteratorï¼ŒåŒ…å«äº†æ‰€æœ‰åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¿…é¡»è®¾ç½®äº†å…¨å±€æ¨¡å¼ gï¼Œå¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚

## globalThis

why:

js åœ¨æµè§ˆå™¨ä¸­çš„å…¨å±€å¯¹è±¡æ˜¯`window`ï¼Œåœ¨ Node ç¯å¢ƒä¸‹æ˜¯`global`ï¼Œåœ¨ web workers ä¸­æ˜¯`self`ã€‚

what:

globalThis æ˜¯åœ¨æ‰€æœ‰å¹³å°éƒ½å¯ä»¥ä½¿ç”¨çš„å…¨å±€å¯¹è±¡ã€‚

```js
// in browser
globalThis.setTimeout === window.setTimeout; // true

// in node, nodeç‰ˆæœ¬12.0.0
globalThis.setTimeout === global.setTimeout;
```

## Moudule Namespace Exports

why:

```js
export { foo, bar } from "my_module";

// ç­‰åŒäº
import { foo, bar } from "my_module";
export { foo, bar };
```

```js
export { default } from "my_module";
```

```js
export { foo as default } from "my_module";

// ç­‰åŒäº
import { foo } from "my_module";
export default foo;
```

```js
export { default as bar } from "my_moudle";
```

what:

```js
export * as ns from 'mod'

// ç­‰åŒäº
import * from 'mod'
export {ns}
```

## Well defined for-in order

ä»¥å‰ä¸åŒçš„å¼•æ“å¯¹äº`for...in`æ‰§è¡Œé¡ºåºçš„å®ç°ä¸åŒï¼Œå¯¼è‡´è¿™ä¸€æ ‡å‡†ä¸€ç›´ä¸èƒ½ç¡®å®šï¼Œè¿™æ¬¡ä¸åŒçš„å¼•æ“å°±`for...in`å¾ªç¯çš„è¿­ä»£é¡ºåºè¾¾æˆä¸€è‡´ï¼Œå®ç°æ ‡å‡†åŒ–ã€‚

æ‰€ä»¥ ES2020 ä¸è¦æ±‚ç»Ÿä¸€å±æ€§éå†é¡ºåºï¼Œè€Œæ˜¯å¯¹éå†è¿‡ç¨‹ä¸­çš„ä¸€äº›ç‰¹æ®Š Case æ˜ç¡®å®šä¹‰äº†ä¸€äº›è§„åˆ™ï¼š

* éå†ä¸åˆ° Symbol ç±»å‹çš„å±æ€§

* éå†è¿‡ç¨‹ä¸­ï¼Œç›®æ ‡å¯¹è±¡çš„å±æ€§èƒ½è¢«åˆ é™¤ï¼Œå¿½ç•¥æ‰å°šæœªéå†åˆ°å´å·²ç»è¢«åˆ æ‰çš„å±æ€§

* éå†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰æ–°å¢å±æ€§ï¼Œä¸ä¿è¯æ–°çš„å±æ€§èƒ½è¢«å½“æ¬¡éå†å¤„ç†åˆ°

* å±æ€§åä¸ä¼šé‡å¤å‡ºç°ï¼ˆä¸€ä¸ªå±æ€§åæœ€å¤šå‡ºç°ä¸€æ¬¡ï¼‰

* ç›®æ ‡å¯¹è±¡æ•´æ¡åŸå‹é“¾ä¸Šçš„å±æ€§éƒ½èƒ½éå†åˆ°

## import.meta

è·å–æ¨¡å—çš„å…ƒä¿¡æ¯ã€‚éœ€è¦æŒ‡å®š type="module"

```js
<script type="module" src="module.js"></script>;

// module.js
console.log(import.meta);
```

[test link](https://codesandbox.io/s/musing-haslett-gmhj6?file=/test.js)

è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ…å« url å±æ€§çš„å¯¹è±¡ï¼Œurl æ˜¯å½“å‰æ¨¡å—çš„ç»å¯¹è·¯å¾„ã€‚è¿™ä¸ªå¯¹è±¡æ²¡æœ‰åŸå‹å¯¹è±¡ã€‚

å‚è€ƒæ–‡ç« ï¼š

[from medium](https://blog.bitsrc.io/es2020-has-been-finalized-here-is-what-im-excited-about-414959bc2f7f)

[from freecodecamp](https://www.freecodecamp.org/news/javascript-new-features-es2020/)

[from dev.to](https://dev.to/carlillo/es2020-features-in-simple-examples-1513)

[MDN å¯¹åº”çš„çŸ¥è¯†ç‚¹]
