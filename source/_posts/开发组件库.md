---
title: 开发组件库
date: 2020-07-14 18:38:25
tags: react
---

记录组件库开发过程中遇到的问题

<!-- more -->
## 组件库框架

  使用的是[dumi](https://d.umijs.org/)

## 组件库打包

  没有使用dumi自带的father-build，自己实现打包功能。我只是使用了cjs和es打包，使用tsc编译输出`.d.ts`文件。

  配置打包参考文章：

  [umd、cjs、es三种模式打包](https://segmentfault.com/a/1190000020093455)

  [从dist到es](https://segmentfault.com/a/1190000018242549)

  [tsc 打包配置](https://www.typescriptlang.org/docs/handbook/compiler-options.html#compiler-options)

## 文档发布

  组件库文档打包后发布到[vercel](https://vercel.com/)上

## npm 发包

  组件库打包后发布到npm上。

  发布遇到的问题是选择哪些内容可以被publish,。[npm-publish文档](https://www.npmjs.cn/cli/publish/)

## 遇到的问题

  1. 组件库依赖问题。我写的组件库是基于antd进一步封装，因此其`package.json`中会包含antd以及其他可能需要用的包的依赖，但antd在业务项目中也会用到，为了防止antd被安装两次，需要把这些依赖放到`peerDependencies`中。请查看[关于peerDependencies的具体介绍](https://www.cnblogs.com/wonyun/p/9692476.html)。

  2. 在打包过程中，遇到了[这个问题](https://github.com/vfile/vfile/issues/44)，导致的原因是[这个](https://github.com/gucong3000/postcss-markdown/issues/32)。简而言之就是旧版的`remark`包依赖的另外两个包废弃了，导致一致报错。解决办法就是在`package.json`中自定义`remark`的版本为最新，通过`resolutions`字段指定包的版本。[关于resolutions的详细内容](https://classic.yarnpkg.com/en/docs/selective-version-resolutions/)。